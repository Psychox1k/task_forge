{% extends 'layouts/base-presentation.html' %}

{% block title %}Task Details{% endblock title %}





{% block content %}


<div class="container my-5" style="max-width: 900px;">
<!-- Messages --><!-- Messages -->
{% if request.GET.success %}
    <div class="alert alert-success alert-dismissible fade show" role="alert">
      <strong>Success!</strong> Task marked as completed successfully!
      <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>
  {% endif %}

  {% if request.GET.error %}
    <div class="alert alert-danger alert-dismissible fade show" role="alert">
      <strong>Access Denied!</strong> Sorry, mark as done can only be used by person to who this task was assigned or by the team lead!
      <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>
  {% endif %}


  <div class="card shadow rounded-4">
    <div class="card-header d-flex justify-content-between align-items-center">
      <h4 class="mb-0">{{ task.name }}</h4>
      <div class="d-flex gap-2">
        <a href="{% url 'task:task-update' pk=task.id %}" class="btn btn-sm btn-info">
          <i class="ni ni-ruler-pencil me-1"></i>Edit
        </a>
        <a href="{% url 'task:task-delete' pk=task.id %}" class="btn btn-sm btn-danger">
          <i class="ni ni-fat-remove me-1"></i>Delete
        </a>
      </div>
    </div>
    <div class="card-body p-4">

      <!-- Description -->
      <div class="mb-4">
        <h6 class="text-uppercase text-secondary text-xxs font-weight-bolder">Description</h6>
        <p class="text-sm mb-0">{{ task.description }}</p>
      </div>

      <!-- Deadline & Status -->
      <div class="row mb-4">
        <div class="col-md-6">
          <h6 class="text-uppercase text-secondary text-xxs font-weight-bolder">Deadline</h6>
          <p class="mb-0 text-sm">
            {{ task.deadline|date:"M d, Y H:i" }}
          </p>
        </div>
        <div class="col-md-6">
          <h6 class="text-uppercase text-secondary text-xxs font-weight-bolder">Status</h6>
          {% if task.is_completed %}
            <span class="badge bg-gradient-success">
              <i class="ni ni-check-bold me-1"></i>Completed
            </span>
          {% else %}
            <span class="badge bg-gradient-secondary">
              <i class="ni ni-time-alarm me-1"></i>Pending
            </span>
          {% endif %}
        </div>
      </div>

      <!-- Priority & Task Type -->
      <div class="row mb-4">
        <div class="col-md-6">
          <h6 class="text-uppercase text-secondary text-xxs font-weight-bolder">Priority</h6>
          {% with p=task.priority %}
            <span class="badge
              {% if p == 'critical' %}bg-gradient-danger
              {% elif p == 'high' %}bg-gradient-warning
              {% elif p == 'medium' %}bg-gradient-info
              {% else %}bg-gradient-success{% endif %}
              text-xs">
              {{ task.get_priority_display }}
            </span>
          {% endwith %}
        </div>
        <div class="col-md-6">
          <h6 class="text-uppercase text-secondary text-xxs font-weight-bolder">Task Type</h6>
          <p class="mb-0 text-sm">{{ task.task_type|default:"—" }}</p>
        </div>
      </div>

      <!-- Project -->
      <div class="mb-4">
        <h6 class="text-uppercase text-secondary text-xxs font-weight-bolder">Project</h6>
        {% if task.project %}
          <span class="badge bg-gradient-info">{{ task.project.name }}</span>
        {% else %}
          <span class="text-muted text-sm">No project assigned</span>
        {% endif %}
      </div>

      <!-- Assignees -->
      <div class="mb-4">
        <h6 class="text-uppercase text-secondary text-xxs font-weight-bolder">Assignees</h6>
        {% if task.assignees.all %}
          {% for assignee in task.assignees.all %}
            <span class="badge bg-secondary me-1">{{ assignee.username }}</span>
          {% endfor %}
        {% else %}
          <span class="text-muted text-sm">No assignees</span>
        {% endif %}
      </div>

      <!-- Tags -->
      <div class="mb-4">
        <h6 class="text-uppercase text-secondary text-xxs font-weight-bolder">Tags</h6>
        {% if task.tags.all %}
          {% for tag in task.tags.all %}
            <span class="badge bg-light text-dark me-1">{{ tag.name }}</span>
          {% endfor %}
        {% else %}
          <span class="text-muted text-sm">No tags</span>
        {% endif %}
      </div>

      <!-- Mark as Done -->
      {% if not task.is_completed %}
      <div class="mt-4">
        <a href="{% url 'task:mark-as-done' pk=task.id%}" class="btn btn-success">
          <i class="ni ni-check-bold me-1"></i>Mark as Done
        </a>
      </div>
      {% endif %}

    </div>
    <div class="card-footer text-end">
      <a href="{% url 'task:task-list' %}" class="btn btn-secondary btn-sm">← Back to Task List</a>
    </div>
  </div>
</div>
{% endblock content %}